# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è

> üìñ **–°–º. —Ç–∞–∫–∂–µ**:
>
> - [QUICK_SETUP.md](./QUICK_SETUP.md) - –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
> - [INDEX.md](./INDEX.md) - –ò–Ω–¥–µ–∫—Å –≤—Å–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å alfares**: –≤–ª–∞–¥–µ–ª–µ—Ü nginx-microservice –≤ `/home/alfares/nginx-microservice`
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å belunga**: –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ —Å–∫—Ä–∏–ø—Ç–∞–º –¥–µ–ø–ª–æ—è
- **–ü—Ä–æ–±–ª–µ–º–∞**: –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `/home/alfares` –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ `drwxr-x---` (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å)
- **–û–±–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** —É–∂–µ –≤ –≥—Ä—É–ø–ø–µ `docker` (988)

## –†–µ—à–µ–Ω–∏–µ: –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—â–µ–π –≥—Ä—É–ø–ø—ã –¥–ª—è –¥–µ–ø–ª–æ—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±—â–∞—è –≥—Ä—É–ø–ø–∞ `deployers` (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–æ–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –¥–µ–ø–ª–æ–∏—Ç—å —Å–≤–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ –æ–±—â–∏–π nginx-microservice.

#### –®–∞–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å sudo –ø—Ä–∞–≤–∞–º–∏)

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –æ–±—â—É—é –≥—Ä—É–ø–ø—É –¥–ª—è –¥–µ–ø–ª–æ—è
sudo groupadd deployers

# 2. –î–æ–±–∞–≤–∏—Ç—å –æ–±–æ–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –≥—Ä—É–ø–ø—É
sudo usermod -a -G deployers alfares
sudo usermod -a -G deployers belunga

# 3. –ò–∑–º–µ–Ω–∏—Ç—å –≥—Ä—É–ø–ø—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ nginx-microservice
sudo chgrp -R deployers /home/alfares/nginx-microservice

# 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (–≤–ª–∞–¥–µ–ª–µ—Ü –∏ –≥—Ä—É–ø–ø–∞ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å/–≤—ã–ø–æ–ª–Ω—è—Ç—å)
sudo chmod -R 775 /home/alfares/nginx-microservice

# 5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SGID –±–∏—Ç –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (–Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è —Å –≥—Ä—É–ø–ø–æ–π deployers)
sudo chmod g+s /home/alfares/nginx-microservice

# 6. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ
sudo chmod +x /home/alfares/nginx-microservice/scripts/blue-green/deploy-smart.sh
```

#### –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–û–±–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω—ã **–ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è** (–∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `newgrp deployers`) —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—Ç—É–ø–∏–ª–∏ –≤ —Å–∏–ª—É.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –≥—Ä—É–ø–ø—ã `docker`

–ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥—Ä—É–ø–ø—É `docker`:

```bash
# 1. –ò–∑–º–µ–Ω–∏—Ç—å –≥—Ä—É–ø–ø—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ nginx-microservice –Ω–∞ docker
sudo chgrp -R docker /home/alfares/nginx-microservice

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ (–≥—Ä—É–ø–ø–∞ docker –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–≤—ã–ø–æ–ª–Ω—è—Ç—å)
sudo chmod -R 775 /home/alfares/nginx-microservice

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SGID –±–∏—Ç
sudo chmod g+s /home/alfares/nginx-microservice

# 4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ
sudo chmod +x /home/alfares/nginx-microservice/scripts/blue-green/deploy-smart.sh
```

**–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫**: –≥—Ä—É–ø–ø–∞ docker –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Docker socket, —Å–º–µ—à–∏–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ.

### –í–∞—Ä–∏–∞–Ω—Ç 3: –°–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è —Å—Å—ã–ª–∫–∞ –≤ –æ–±—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

–°–æ–∑–¥–∞—Ç—å –æ–±—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –¥–µ–ø–ª–æ—è —Å–∫—Ä–∏–ø—Ç–æ–≤:

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –æ–±—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
sudo mkdir -p /opt/deploy-scripts
sudo chown alfares:deployers /opt/deploy-scripts
sudo chmod 775 /opt/deploy-scripts

# 2. –°–æ–∑–¥–∞—Ç—å —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É –Ω–∞ —Å–∫—Ä–∏–ø—Ç—ã
sudo ln -s /home/alfares/nginx-microservice/scripts /opt/deploy-scripts/nginx-microservice

# 3. –¢–µ–ø–µ—Ä—å belunga –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
# /opt/deploy-scripts/nginx-microservice/blue-green/deploy-smart.sh
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–æ–≤, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–∂–Ω–æ —Ç–∞–∫:

```bash
# –û—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è belunga:
ssh alfares
groups  # –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å deployers (–∏–ª–∏ docker)
ls -la /home/alfares/nginx-microservice/scripts/blue-green/deploy-smart.sh
# –î–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å —Ñ–∞–π–ª –∏ –ø—Ä–∞–≤–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å -rwxr-xr-x –∏–ª–∏ -rwxrwxr-x
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –¥–µ–ø–ª–æ—è

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å belunga –º–æ–∂–µ—Ç –¥–µ–ø–ª–æ–∏—Ç—å —Ç–∞–∫:

```bash
ssh alfares
cd /home/alfares/nginx-microservice/scripts/blue-green
./deploy-smart.sh sgiprealestate
```

–ò–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏–º–ª–∏–Ω–∫ –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–∞ 3:

```bash
ssh alfares
/opt/deploy-scripts/nginx-microservice/blue-green/deploy-smart.sh sgiprealestate
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –û–±–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –≤ –≥—Ä—É–ø–ø–µ docker (–º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏)
- ‚úÖ –û–±—â–∞—è –≥—Ä—É–ø–ø–∞ deployers –ø–æ–∑–≤–æ–ª–∏—Ç —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞—Ç—å/–≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–∫—Ä–∏–ø—Ç—ã nginx-microservice
- ‚úÖ Docker –∏ nginx –æ—Å—Ç–∞—é—Ç—Å—è –æ–±—â–∏–º–∏ (–∫–∞–∫ –∏ —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å)
- ‚ö†Ô∏è  –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–∞—Ä–æ–ª–∏, –∫–ª—é—á–∏)

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (—Å–∫—Ä–∏–ø—Ç)

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç `scripts/setup-deploy-permissions.sh`:

```bash
# 1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
scp scripts/setup-deploy-permissions.sh alfares:/tmp/

# 2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh alfares

# 3. –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∫—Ä–∏–ø—Ç —Å sudo –ø—Ä–∞–≤–∞–º–∏
sudo /tmp/setup-deploy-permissions.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

- –°–æ–∑–¥–∞—Å—Ç –≥—Ä—É–ø–ø—É `deployers` (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- –î–æ–±–∞–≤–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π `alfares` –∏ `belunga` –≤ –≥—Ä—É–ø–ø—É
- –ù–∞—Å—Ç—Ä–æ–∏—Ç –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é nginx-microservice
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –ø—Ä–∞–≤–∞ –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–∞—Ä–∏–∞–Ω—Ç 1** (–≥—Ä—É–ø–ø–∞ `deployers`) - —ç—Ç–æ –Ω–∞–∏–±–æ–ª–µ–µ —á–∏—Å—Ç–æ–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ:

- –†–∞–∑–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ Docker –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∫—Ä–∏–ø—Ç–∞–º –¥–µ–ø–ª–æ—è
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±—É–¥—É—â–µ–º
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—É –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

**–î–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `scripts/setup-deploy-permissions.sh`**
